<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.jsdelivr.net/npm/@vladmandic/face-api/dist/face-api.js"></script>
    <style>
        body { margin: 0; background: #000; overflow: hidden; color: white; text-align: center; font-family: sans-serif; }
        canvas { position: absolute; left: 0; top: 0; }
        video { position: absolute; left: 0; top: 0; width: 100%; height: 100%; object-fit: cover; }
        #log { position: absolute; top: 10px; width: 100%; z-index: 100; background: rgba(0,0,0,0.5); }
    </style>
</head>
<body>
    <div id="log">טוען מודלים...</div>
    <video id="video" playsinline autoplay muted></video>
    <canvas id="canvas"></canvas>

<script>
const video = document.getElementById('video');
const canvas = document.getElementById('canvas');
const log = document.getElementById('log');

async function setup() {
    log.innerText = "טוען AI...";
    // טעינת המודלים ישירות משרת חיצוני
    await faceapi.nets.tinyFaceDetector.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
    await faceapi.nets.faceLandmark68Net.loadFromUri('https://cdn.jsdelivr.net/npm/@vladmandic/face-api/model/');
    
    log.innerText = "מבקש מצלמה...";
    const stream = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
    video.srcObject = stream;

    video.onloadedmetadata = () => {
        canvas.width = video.offsetWidth;
        canvas.height = video.offsetHeight;
        log.innerText = "מחפש פנים - גע במסך!";
        detect();
    };
}

async function detect() {
    const displaySize = { width: video.offsetWidth, height: video.offsetHeight };
    faceapi.matchDimensions(canvas, displaySize);

    setInterval(async () => {
        const detections = await faceapi.detectAllFaces(video, new faceapi.TinyFaceDetectorOptions()).withFaceLandmarks();
        const resizedDetections = faceapi.resizeResults(detections, displaySize);
        
        const ctx = canvas.getContext('2d');
        ctx.clearRect(0, 0, canvas.width, canvas.height);

        if (detections.length > 0) {
            log.style.display = 'none';
            // ציור נקודות הפנים
            faceapi.draw.drawFaceLandmarks(canvas, resizedDetections);
            
            // ציור קו האף (ציר הסימטריה)
            const landmarks = detections[0].landmarks;
            const nose = landmarks.getNose();
            const topNose = nose[0]; // הנקודה העליונה של האף
            
            ctx.strokeStyle = '#00ff00';
            ctx.lineWidth = 5;
            ctx.beginPath();
            ctx.moveTo(topNose.x * (canvas.width/video.videoWidth), 0);
            ctx.lineTo(topNose.x * (canvas.width/video.videoWidth), canvas.height);
            ctx.stroke();
        } else {
            log.style.display = 'block';
            log.innerText = "לא מזהה פנים - תתקרב למצלמה";
        }
    }, 100);
}

document.body.addEventListener('click', () => video.play());
setup();
</script>
</body>
</html>
